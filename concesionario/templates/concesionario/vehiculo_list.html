{% extends 'base.html' %}
<<<<<<< HEAD
{% load humanize %}
=======
{% load humanize %} <!-- Cargar el filtro de humanización -->
>>>>>>> fc8ba0a41a8635567d5705060d161bf95028d91e

{% block title %}Lista de Vehículos{% endblock %}

{% block content %}
<div class="container mt-4">
<<<<<<< HEAD
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">Filtros de Búsqueda</h3>
        </div>
        <div class="card-body">
            <form method="get" class="row">
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="modelo">Modelo</label>
                        <input type="text" class="form-control" id="modelo" name="modelo" value="{{ filtros.modelo }}">
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="marca">Marca</label>
                        <select class="form-control" id="marca" name="marca">
                            <option value="">Todas</option>
                            {% for marca in marcas %}
                            <option value="{{ marca.nombre }}" {% if filtros.marca == marca.nombre %}selected{% endif %}>
                                {{ marca.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="precio_min">Precio Mínimo</label>
                        <input type="text" class="form-control precio-input" id="precio_min" name="precio_min" value="{{ filtros.precio_min }}">
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="precio_max">Precio Máximo</label>
                        <input type="text" class="form-control precio-input" id="precio_max" name="precio_max" value="{{ filtros.precio_max }}">
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="año">Año</label>
                        <input type="number" class="form-control" id="año" name="año" value="{{ filtros.año }}">
                    </div>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Filtrar</button>
                        <a href="{% url 'vehiculo_list' %}" class="btn btn-secondary">Limpiar</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

=======
>>>>>>> fc8ba0a41a8635567d5705060d161bf95028d91e
    <div class="card">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h3 class="mb-0">Lista de Vehículos</h3>
            <a href="{% url 'vehiculo_create' %}" class="btn btn-dark ml-auto">Crear Vehículo</a>
        </div>
        <div class="card-body">
<<<<<<< HEAD
            {% if vehiculos %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Modelo</th>
                            <th scope="col">Color</th>
                            <th scope="col">Año</th>
                            <th scope="col">Precio</th>
                            <th scope="col">Marca</th>
                            <th scope="col">Disponibilidad</th>
                            <th scope="col">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vehiculo in vehiculos %}
                        <tr>
                            <td>{{ vehiculo.modelo }}</td>
                            <td>{{ vehiculo.color }}</td>
                            <td>{{ vehiculo.año }}</td>
                            <td>${{ vehiculo.precio_formateado }}</td>
                            <td>{{ vehiculo.marca.nombre }}</td>
                            <td>
                                {% if vehiculo.disponibilidad %}
                                    <span class="badge bg-success">Disponible</span>
                                {% else %}
                                    <span class="badge bg-danger">No disponible</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="btn-group" role="group">
                                    <a href="{% url 'vehiculo_update' vehiculo.pk %}" class="btn btn-sm btn-warning">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a href="{% url 'vehiculo_delete' vehiculo.pk %}" class="btn btn-sm btn-danger">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info">
                <i class="fas fa-info-circle mr-2"></i>
                No se encontraron vehículos con los filtros seleccionados.
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Función para formatear números
        function formatNumber(numero) {
            // Convertir a string y eliminar puntos existentes
            let str = numero.toString().replace(/\./g, '');
            
            // Validar longitud máxima
            if (str.length > 13) {
                str = str.slice(0, 13);
            }
            
            // Agregar puntos como separadores de miles
            return str.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        // Aplicar formato a los campos de precio
        const precioInputs = document.querySelectorAll('.precio-input');
        precioInputs.forEach(input => {
            input.addEventListener('input', function(e) {
                // Obtener solo los números
                let valor = this.value.replace(/[^\d]/g, '');
                
                // Aplicar formato si hay valor
                if (valor) {
                    this.value = formatNumber(valor);
                }
            });
        });

        // Validación de rango de precios
        const precioMin = document.getElementById('precio_min');
        const precioMax = document.getElementById('precio_max');
        
        precioMax.addEventListener('change', function() {
            const valorMin = parseInt(precioMin.value.replace(/\./g, '')) || 0;
            const valorMax = parseInt(this.value.replace(/\./g, '')) || 0;
            
            if (valorMin > valorMax && valorMax !== 0) {
                alert('El precio máximo debe ser mayor que el precio mínimo');
                this.value = '';
            }
        });

        // Modificar el evento submit del formulario
        document.querySelector('form').addEventListener('submit', function(e) {
            e.preventDefault(); // Prevenir el envío por defecto
            
            const precioMin = document.getElementById('precio_min');
            const precioMax = document.getElementById('precio_max');
            
            // Validar que los precios sean coherentes
            if (precioMin.value && precioMax.value) {
                const valorMin = parseInt(precioMin.value.replace(/\./g, ''));
                const valorMax = parseInt(precioMax.value.replace(/\./g, ''));
                
                if (valorMin > valorMax) {
                    alert('El precio mínimo no puede ser mayor que el precio máximo');
                    return;
                }
            }
            
            // Limpiar los valores antes del envío
            if (precioMin.value) {
                precioMin.value = precioMin.value.replace(/\./g, '');
            }
            if (precioMax.value) {
                precioMax.value = precioMax.value.replace(/\./g, '');
            }
            
            this.submit(); // Enviar el formulario
        });
    });
</script>
=======
            <table class="table table-striped table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">Modelo</th>
                        <th scope="col">Color</th>
                        <th scope="col">Año</th>
                        <th scope="col">Precio</th>
                        <th scope="col">Marca</th>
                        <th scope="col">Disponibilidad</th>
                        <th scope="col">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for vehiculo in vehiculos %}
                    <tr>
                        <td>{{ vehiculo.modelo }}</td>
                        <td>{{ vehiculo.color }}</td>
                        <td>{{ vehiculo.año }}</td>
                        <td>{{ vehiculo.precio|intcomma }}</td> <!-- Formatear precio con intcomma -->
                        <td>{{ vehiculo.marca.nombre }}</td>
                        <td>{{ vehiculo.disponibilidad|yesno:"Disponible,No disponible" }}</td>
                        <td>
                            <a href="{% url 'vehiculo_update' vehiculo.pk %}" class="btn btn-sm btn-warning">Editar</a>
                            <a href="{% url 'vehiculo_delete' vehiculo.pk %}" class="btn btn-sm btn-danger">Eliminar</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
>>>>>>> fc8ba0a41a8635567d5705060d161bf95028d91e
{% endblock %}
